// This is your Prisma schema file,

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider  = "postgresql"
  url       = env("DATABASE_URL")
  directUrl = env("DIRECT_URL")
}

// 성별에 사용할 선택지 정의
enum Gender {
  MALE
  FEMALE
  PREFER_NOT_TO_SAY
}

model User {
  user_id      Int    @id @default(autoincrement())
  user_loginID String @unique
  email        String @unique
  googleId     String? @unique
  googleEmail  String? @unique
  loginType    String  @default("email") // email, google, etc.
  name         String
  password     String

  gender    Gender
  birthDate DateTime

  created_at DateTime @default(now())
  active     Boolean  @default(true)

  clothings     Clothing[]
  outfits       Outfit[]
  tokens        Token[]
  oauthAccounts OauthAccount[]
  closets       Closet[]
  dates         Date[]

  @@map("User")
}

model OauthAccount {
  id               Int    @id @default(autoincrement())
  provider         String
  provider_user_id String
  user_id          Int

  user User @relation(fields: [user_id], references: [user_id], onDelete: Cascade)

  @@unique([provider, provider_user_id])

  @@map("oauth_account")
}

model Token {
  token_id   Int      @id @default(autoincrement())
  token_hash String
  expires_at DateTime
  created_at DateTime @default(now())
  user_id    Int

  user User @relation(fields: [user_id], references: [user_id], onDelete: Cascade)

  @@map("Token")
}

model Category {
  category_id Int    @id @default(autoincrement())
  name            String

  @@map("Category")
  clothings    Clothing[]
}

model ClosetTemplate {
  closet_template_id Int    @id @default(autoincrement())
  template_name      String

  created_at DateTime @default(now())
  updated_at DateTime @updatedAt

  closets          Closet[]
  sectionTemplates SectionTemplate[]

  @@map("ClosetTemplate")
}

model SectionTemplate {
  section_template_id Int    @id @default(autoincrement())
  closet_template_id  Int
  section_type        String
  position_order      Int
  default_name        String

  created_at DateTime @default(now())
  updated_at DateTime @updatedAt

  closetTemplate ClosetTemplate @relation(fields: [closet_template_id], references: [closet_template_id])
  sections       Section[]

  @@map("SectionTemplate")
}

model Closet {
  closet_id          Int    @id @default(autoincrement())
  closet_template_id Int
  user_id            Int
  closet_name        String

  created_at DateTime @default(now())
  updated_at DateTime @updatedAt

  user           User           @relation(fields: [user_id], references: [user_id], onDelete: Cascade)
  closetTemplate ClosetTemplate @relation(fields: [closet_template_id], references: [closet_template_id])
  sections       Section[]
  clothings      Clothing[]

  @@map("Closet")
}

model Section {
  section_id          Int    @id @default(autoincrement())
  section_template_id Int
  closet_id           Int
  name                String

  created_at DateTime @default(now())
  updated_at DateTime @updatedAt

  sectionTemplate SectionTemplate @relation(fields: [section_template_id], references: [section_template_id])
  closet          Closet          @relation(fields: [closet_id], references: [closet_id], onDelete: Cascade)
  clothings       Clothing[]

  @@map("Section")
}

model Clothing {
  clothing_id    Int @id @default(autoincrement())
  user_id        Int
  closet_id      Int
  section_id     Int
  category_id Int

  temperature Int? // 적정 온도 (섭씨, nullable)
  image       String // 이미지 URL

  created_at DateTime @default(now())
  updated_at DateTime @updatedAt

  user          User          @relation(fields: [user_id], references: [user_id], onDelete: Cascade)
  closet        Closet        @relation(fields: [closet_id], references: [closet_id], onDelete: Cascade)
  section       Section       @relation(fields: [section_id], references: [section_id], onDelete: Cascade)
  category  Category   @relation(fields: [category_id], references: [category_id])
  outfitClothes OutfitCloth[]

  @@map("Clothing")
}

model Outfit {
  outfit_id   Int      @id @default(autoincrement())
  user_id     Int
  is_heart    Boolean       @default(false)
  is_star     Boolean       @default(false)
  created_at  DateTime @default(now())

  user         User          @relation(fields: [user_id], references: [user_id], onDelete: Cascade)
  outfitCloths OutfitCloth[]
  dates        Date[]

  @@map("Outfit")
}

model OutfitCloth {
  outfit_id   Int
  clothing_id Int

  outfit   Outfit   @relation(fields: [outfit_id], references: [outfit_id], onDelete: Cascade)
  clothing Clothing @relation(fields: [clothing_id], references: [clothing_id], onDelete: Cascade)

  @@id([outfit_id, clothing_id])
  @@map("OutfitCloth")
}

model Date {
  date_id   Int      @id @default(autoincrement())
  outfit_id Int
  wear_date DateTime
  user_id   Int
  memo      String?  @db.Text

  outfit Outfit @relation(fields: [outfit_id], references: [outfit_id], onDelete: Cascade)
  user   User   @relation(fields: [user_id], references: [user_id], onDelete: Cascade)

  @@map("Date")
}

model EmailVerification {
  id         Int      @id @default(autoincrement())
  email      String
  code       String
  expires_at DateTime
  created_at DateTime @default(now())
  verified   Boolean  @default(false)

  @@map("EmailVerification")
}
